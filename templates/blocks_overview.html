{% for block in blocks %}
<li
  class="block{% if !block.can_create_child(None) %} block-cannot-create-child{% endif %}"
  {% if show_all && (block.height > 0) %}:class="{ 'clickable-block': !open }"{% endif %}
  x-data="{ 'open': false }"
  @click="open = true"
  @click.outside="open = false"
  >
  <div class="block-header">
    <div class="hash-and-tags">
      <p class="hash">{{ block.short_hash() }}</p>
      {% if show_all %}
      <div class="tag tag-chain-length" title="Chain length: {{ block.height + 1 }}">Chain length: {{ block.height + 1 }}</div>
      {% for tag in block.tags(None, &blocks, main_chain_hashes) %}
      <div class="tag tag-{{ tag.value() }}" title="{{ tag.label() }}">{{ tag.label() }}</div>
      {% endfor %}
      {% endif %}
    </div>
    <p class="block-name">{{ block.name }}</p>
  </div>
  <hr/>
  <div class="block-message"><pre>{{ block.message }}</pre></div>
  {% if show_all && (block.height > 0) %}
    <button x-show="!open" class="button button-secondary">Show details</button>
    <div x-show="open" :data-block-details-open="open">
      <table class="block-details">
        <caption>Block details</caption>
        <tbody>
          <tr>
            <td>Scramble</td>
            <td>{{ block.scramble() }}</td>
          </tr>
          <tr>
            <td>Solution</td>
            <td>{{ block.solution }}</td>
          </tr>
          <tr>
            <td>Solution moves</td>
            <td>{{ block.solution_moves }}</td>
          </tr>
          <tr>
            <td>Description</td>
            <td>{{ block.solution_description }}</td>
          </tr>
        </tbody>
      </table>
      {% if block.can_create_child(None) %}
      <button
        class="button button-primary"
        hx-get="/block?parent_hash={{ block.hash }}"
        hx-swap="beforeend"
        hx-target="body"
        hx-trigger="click[!document.querySelector('.modal')]"
        hx-push-url="true"
      >Add a new block</button>
      {% else %}
      <p class="block-too-new-warning">This block is made this week, so you can't continue it with a new block yet. Please select an older block.</p>
      {% endif %}
    </div>
  {% endif %}
  {% if let Some(timestamp) = block.created_at %}
  <p class="block-createdat">{{ timestamp }}</p>
  {% endif %}
</li>
{% endfor %}
{% if blocks.len() as u32 == page_size %}
<li
  hx-get="/blocks?all={{ show_all }}&page_size={{ page_size }}&page_offset={{ next_offset }}"
  hx-trigger="revealed"
  hx-swap="outerHTML"
  hx-params="none"
>
  Loading more blocks...
</li>
{% endif %}
